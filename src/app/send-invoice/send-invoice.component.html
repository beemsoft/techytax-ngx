<div class="p-4">
    <div class="container">
        @if (projects() != undefined && projects().length > 1) {
            <select #sel [ngModel]="invoice()" (ngModelChange)="onChangeEvent($event)">
                @for (item of projects(); track item.code) {
                    <option [ngValue]="item" [selected]="invoice().project && invoice().project.code == item.code">
                        {{item.code}}
                    </option>
                }
            </select>
        }
        @if (invoice().project) {
            <div class="card mt-4">
                <div class="card-header">
                    Factuur Details
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="fiscal-item">
                                <label>Project</label>
                                <span class="value text-color">{{invoice().project.projectDescription}}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="fiscal-item">
                                <label>Factuur email</label>
                                <span class="value text-color">{{invoice().project.customer.emailInvoice}}</span>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Factuur maand</label>
                            <input class="form-control" [ngModel]="invoice().month" (ngModelChange)="invoice().month=$event; updateDescription()">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Factuur nummer</label>
                            <input class="form-control" [ngModel]="invoice().invoiceNumber" (ngModelChange)="invoice().invoiceNumber=$event; updateDescription()">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="fiscal-item">
                                <label># Uren</label>
                                <span class="value accent-text">{{invoice().unitsOfWork}}</span>
                            </div>
                        </div>
                        @if (invoice().unitsOfWork && invoice().unitsOfWork < 0) {
                            <div class="col-md-8">
                                <label class="form-label">Oorspronkelijke factuur nummer</label>
                                <input class="form-control" [ngModel]="invoice().originalInvoiceNumber" (ngModelChange)="invoice().originalInvoiceNumber=$event">
                            </div>
                        }
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="fiscal-item">
                                <label>Omzet (subtotaal)</label>
                                <span class="value accent-text">{{subTotal() | currency:'EUR'}}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="fiscal-item">
                                <label>Omzet (totaal)</label>
                                <span class="value neon-text">{{invoice().revenue | currency:'EUR'}}</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Begeleidende tekst</label>
                        <textarea class="form-control" rows="6" [ngModel]="invoice().htmlText" (ngModelChange)="invoice().htmlText=$event"></textarea>
                    </div>

                    <div class="checkbox mb-4 p-2 rounded" style="background: rgba(255, 255, 255, 0.05);">
                        <input type="checkbox" (change)="approveInvoice.set(!approveInvoice())" id="approve">
                        <label class="ms-2 mb-0" for="approve" style="cursor: pointer;">Ik geef toestemming voor het opslaan van mijn gegevens.</label>
                    </div>

                    <div class="d-flex align-items-center justify-content-between">
                        <button mat-raised-button color="accent" (click)="sendInvoice()" [disabled]="isButtonDisabled()">
                            <mat-icon>send</mat-icon> Stuur factuur
                        </button>
                        <div class="d-flex align-items-center">
                            <label class="me-2 mb-0">Test email:</label>
                            <input class="form-control" style="width: 250px;" [ngModel]="invoice().project.customer.emailInvoice" (ngModelChange)="invoice().project.customer.emailInvoice=$event">
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
