<div class="p-4">
    <div class="container">
        <h1>Factuur</h1>
        <p class="lead">Genereer professionele PDF-facturen direct op je lokale systeem.</p>

        @if (shellService.licenseStatus() === 'expired') {
          <div class="alert alert-danger d-flex align-items-center mb-4">
            <mat-icon class="mr-2">error</mat-icon>
            <span>
              Je licentie is <strong>verlopen</strong>. Het genereren van nieuwe facturen is daarom uitgeschakeld.
              Bestaande gegevens blijven gewoon inzichtelijk.
              Verleng je licentie in het <a routerLink="/shell/license">Licentie Beheer</a> om weer facturen te kunnen maken.
            </span>
          </div>
        }
        @if (projects() != undefined && projects().length > 1) {
            <select #sel [ngModel]="invoice()" (ngModelChange)="onChangeEvent($event)">
                @for (item of projects(); track item.code) {
                    <option [ngValue]="item" [selected]="invoice().project && invoice().project.code == item.code">
                        {{item.code}}
                    </option>
                }
            </select>
        }
        @if (invoice().project) {
            <div class="card mt-4 shadow">
                <div class="card-header">
                    <mat-icon class="mr-2">description</mat-icon> Factuur Details
                </div>
                <div class="card-body info-text-large">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="fiscal-item">
                                <label>Project</label>
                                <span class="value text-color">{{invoice().project.projectDescription}}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="fiscal-item">
                                <label>Factuur email</label>
                                <span class="value text-color">{{invoice().project.customer.emailInvoice}}</span>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Factuur maand</label>
                            <input class="form-control form-control-lg" [ngModel]="invoice().month" (ngModelChange)="invoice().month=$event; updateDescription()" [disabled]="shellService.licenseStatus() === 'expired'">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Factuur nummer</label>
                            <input class="form-control form-control-lg" [ngModel]="invoice().invoiceNumber" (ngModelChange)="invoice().invoiceNumber=$event; updateDescription()" [disabled]="shellService.licenseStatus() === 'expired'">
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-4">
                            <label class="form-label"># Uren</label>
                            <input type="number" class="form-control form-control-lg" [ngModel]="invoice().unitsOfWork" (ngModelChange)="onUnitsOfWorkChange($event)" [disabled]="shellService.licenseStatus() === 'expired'">
                        </div>
                        @if (invoice().unitsOfWork && invoice().unitsOfWork < 0) {
                            <div class="col-md-8">
                                <label class="form-label">Oorspronkelijke factuur nummer</label>
                                <input class="form-control form-control-lg" [ngModel]="invoice().originalInvoiceNumber" (ngModelChange)="invoice().originalInvoiceNumber=$event" [disabled]="shellService.licenseStatus() === 'expired'">
                            </div>
                        }
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="fiscal-item">
                                <label>Omzet (subtotaal)</label>
                                <span class="value accent-text">{{subTotal() | currency:'EUR'}}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="fiscal-item">
                                <label>Omzet (totaal)</label>
                                <span class="value neon-text" style="font-size: 1.2em;">{{invoice().revenue | currency:'EUR'}}</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="form-label">Begeleidende tekst</label>
                        <textarea class="form-control info-text-large" rows="6" [ngModel]="invoice().htmlText" (ngModelChange)="invoice().htmlText=$event" [disabled]="shellService.licenseStatus() === 'expired'"></textarea>
                    </div>

                    <div class="mt-5">
                        <button mat-raised-button color="accent" (click)="sendInvoice()" [disabled]="isButtonDisabled()" class="w-100 py-3 mb-3" style="font-size: 1.1rem;">
                            <mat-icon class="mr-2">picture_as_pdf</mat-icon> Factuur genereren
                        </button>
                        <div class="alert alert-info d-flex align-items-start mb-0">
                            <mat-icon class="mr-3 mt-1">info</mat-icon>
                            <span class="info-text-large">
                                De factuur wordt als PDF gegenereerd op het bestandssysteem. Je kunt deze daarna zelf als bijlage toevoegen in je e-mailprogramma.
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
